<style>
    .form-group {
        margin-bottom: 0px;
    }

    .form-group select {
        flex-grow: 1;
        min-width: 150px;
        margin-right: 10px;
    }
</style>

<div class="d-flex align-items-center mb-3 p-3 border border-opacity-100 bg-white rounded">
    <input id="classId" name="classId" type="hidden">
    <div class="form-group">
        <select id="depId" name="depId" class="form-select">
        </select>
    </div>
    <div class="form-group">
        <select id="courseYear" name="courseYear" class="form-select">
            <option value="112" data-semester="1">112-1</option>
            <option value="112" data-semester="2">112-2</option>
            <option value="111" data-semester="1">111-1</option>
            <option value="111" data-semester="2">111-2</option>
            <option value="110" data-semester="1">110-1</option>
            <option value="110" data-semester="2">110-2</option>
        </select>
    </div>
    <div class="form-group">
        <select id="classGrade" name="classGrade" class="form-select">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
    </div>
    <div class="form-group">
        <select id="className" name="className" class="form-select">
            <option value="甲">甲</option>
            <option value="乙">乙</option>
            <option value="丙">丙</option>
        </select>
    </div>
    <div class="form-group">
        <select id="courseId" name="courseId" class="form-select">
        </select>
    </div>
</div>

<div class="p-3 mb-3 border border-opacity-100 bg-white rounded">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>年份</th>
                <th>學期</th>
                <th>科系</th>
                <th>課名</th>
                <th>學生</th>
                <th>分數</th>
            </tr>
        </thead>
        <tbody id="scoreBody">
        </tbody>
    </table>
    <div class="text-end">
        <button class="btn btn-primary" onclick="saveCourseGrade()">儲存</button>
    </div>
</div>

<div aria-label="Page navigation example" class="border border-opacity-100 bg-white rounded">
    <div class="pagination p-3">
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <!-- 更多分頁按鈕 -->
    </div>
</div>

<script>
    loadDepartment();
    loadTeacherCourse();

    $('#courseId, #courseYear').on('change', async(e) => {
        loadCourseScore();
    });   

    const saveCourseGrade = async() => {
        if (confirm('是否儲存?')) {
            var jsonArr = [];
            $('input[name="score"]').each(function(index, element) {
                jsonArr.push(JSON.parse($(element).attr('data-score')));              
            });
            const response = await fetch('http://localhost:8080/course/updateScore', {
                method : 'PUT',
                headers : {
                    'Content-Type' : 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body : JSON.stringify(jsonArr)
            });
            
            const {state, message, data} = await response.json();
            if (state) {
                alert('儲存成功');
                document.body.scrollTop = 0;
                document.documentElement.scrollTop = 0;
                loadCourseScore();
            }
        }
    }
</script>
